{% extends "tree_analyzer/base.html" %}

{% block content %}
<div id="app">
    <tree-parameters></tree-parameters>
</div>

<div id="node_scores">
    <table>
        <thead>
            <tr>
                <th>Node</th>
                <th>Score</th>
            </tr>
        </thead>
        <tbody>
        {% for node, node_score in case_study.node_scores.items %}
            <tr>
                <td>{{ node }}</td>
                <td>{{ node_score }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<script>
    // <!-- Server-status data for Vue components -->
    var calculus_algorithms = {{ calculus_algorithms| safe }}
    console.log(typeof calculus_algorithms)
    var feat_list = {{ case_study.study_features| safe }}
    console.log(feat_list)
    var csrf_token = '{{ csrf_token }}'

    Vue.component("tree-parameters", {
        delimiters: ['[[', ']]'],
        data: function () {
            return {
            diffGaps: "Y",
            algorithm : "simple",
            calculus_algorithms: calculus_algorithms,
            gaps: "Y",
            }
        },
        methods: {
            onAlgChange(event) {
                this.diffGaps=this.calculus_algorithms[this.algorithm].differentiate_gaps
                if (this.diffGaps === "N"){
                    this.gaps = "N"
                }
                this.$nextTick(function(){ $('#gaps-list').selectpicker('refresh')})
            }
        },
        template:`
            <div id="tree-parameters">
            <h3>Tree computing  parameters</h3>
                <form action="{% url 'design_tree' cluster_number=cluster %}"  method="POST">
                    {% csrf_token %}
                    <div class="form-group">
                        <select class="selectpicker" v-model="algorithm" v-on:change="onAlgChange($event)" name="calc_alg" title="Calculus algorithm" data-header="Calculus algorithm" data-style="btn btn-dark dropdown-toggle">
                            <option v-bind:value="algorithm" v-for="(info, algorithm) in calculus_algorithms">[[ info.fancy_name ]]</option>
                        </select>
                        <select class="selectpicker" id="gaps-list" v-model="gaps" v-bind:disabled="this.diffGaps === 'N'" name="diff_gaps" title="Differentiate gaps" data-header="Differentiate gaps" data-style="btn btn-dark dropdown-toggle">
                            <option value="Y">Yes</option>
                            <option value="N">No</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <select class="selectpicker" multiple name="features" title="Features to analyze" data-header="Features to analyze" data-style="btn btn-dark dropdown-toggle">
                            <option value="ACT_SITE">Active site</option>
                            <option value="NP_BIND">Np bind</option>
                            <option value="BINDING">Binding</option>
                            <option value="POTATO">Potato</option>
                        </select>
                        <input type="number" name="evalue" id="evalue" step=any placeholder="Evalue">
                    </div>
                    <button type="submit" class="btn btn-danger">Recalculate</button>
                </form>
            </div>
        `
    })


    var app = new Vue({
        el: '#app',
        delimiters: ['[[', ']]'],
        data: {
        }
    })
</script>
{% endblock %}